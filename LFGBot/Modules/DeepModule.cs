using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Threading.Tasks;
using System.Timers;
using Discord;
using Discord.Commands;
using Discord.Commands.Builders;
using Discord.WebSocket;
using LFGBot.Services;

namespace LFGBot.Modules
{
    public class DeepModule : ModuleBase<SocketCommandContext>
    {
        private readonly DeepService _deepService;

        public DeepModule(DeepService deepService)
        {
            _deepService = deepService;
        }

        [Command("setchannel")]
        [RequireOwner]
        public async Task SetChannel()
        {
            _deepService.Channel = Context.Channel;
            await Context.Channel.SendMessageAsync($"Bot message channel set to {Context.Channel.Name}");
        }

        [Command("info")]
        public async Task GetChannel()
        {
            var startup = Process.GetCurrentProcess().StartTime;
            var uptime = DateTime.Now - startup;
            
            var builder = new EmbedBuilder();

            builder.WithTitle("LFGBot Info");
            
            builder.AddField("Deep message channel", _deepService.Channel is null ? "unset" : $"{_deepService.Channel.Name}");
            builder.AddField("Number of deep messages sent", "0");
            builder.AddField("Number of images sent", "0");
            builder.AddField("Uptime", uptime.ToString(@"dd\.hh\:mm\:ss"));
            
            builder.WithThumbnailUrl(Context.Client.GetUser(756863887999238216).GetAvatarUrl());
            builder.WithColor(Color.Purple);
            
            await Context.Channel.SendMessageAsync("", false, builder.Build());
        }

        [Command("start")]
        [RequireOwner]
        public async Task Start()
        {
            
        }
        
        [Command("stop")]
        [RequireOwner]
        public async Task Stop()
        {
            
        }

        [Command("interval")]
        [RequireOwner]
        public async Task MessageInterval(int interval)
        {
            _deepService.Interval = interval;
        }
        
        [Command("deep")]
        [Summary("Sends a message generated by the GPT-2 DeepLFG Bot")]
        [RequireOwner]
        public Task DeepMessage()
        {
            return ReplyAsync(_deepService.GetMessage());
        }
    }
}